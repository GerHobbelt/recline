<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Dashboard demo</title>
		<script type="text/javascript" src="js/jquery-1.7.1.js"></script>
		<script type="text/javascript" src="js/d3.v2.min.js"></script>
		<script type="text/javascript" src="js/nvd3/nv.d3.js"></script>
		<script type="text/javascript" src="js/nvd3/tooltip.js"></script>
		<script type="text/javascript" src="js/nvd3/utils.js"></script>
		<script type="text/javascript" src="js/nvd3/models/legend.js"></script>
		<script type="text/javascript" src="js/nvd3/models/axis.js"></script>
		<script type="text/javascript" src="js/nvd3/models/scatter.js"></script>
		<script type="text/javascript" src="js/nvd3/models/line.js"></script>
		<script type="text/javascript" src="js/nvd3/models/lineChart.js"></script>
		<script type="text/javascript" src="js/flotr2.min.js"></script>
		<script type="text/javascript" src="js/crossfilter.js"></script>
		<script type="text/javascript" src="js/underscore.js"></script>
		<script type="text/javascript" src="js/backbone.js"></script>
		<script type="text/javascript" src="js/mustache.js"></script>
		<script type="text/javascript" src="js/bootstrap.js"></script>
		<script type="text/javascript" src="js/recline.js"></script>
		
		<script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>
		<script type="text/javascript" src="js/jquery.event.drag-2.0.min.js"></script>
		<script type="text/javascript" src="js/slick.core.js"></script>
		<script type="text/javascript" src="js/slick.editors.js"></script>
		<script type="text/javascript" src="js/slick.formatters.js"></script>
		<script type="text/javascript" src="js/slick.grid.js"></script>
		
		<link href="css/nv.d3.css" rel="stylesheet" type="text/css">
		<link href="css/bootstrap.css" rel="stylesheet" type="text/css">
		<link href="css/grid.css" rel="stylesheet" type="text/css">
		<link href="css/slick.grid.css" rel="stylesheet" type="text/css">
		<link href="css/default.css" rel="stylesheet" type="text/css">
		
		<script type="text/javascript">
			$(document).ready(function() {		
				var url = "http://192.168.100.133:8380/cwwh-iwal-war/cw/wh/ds/AudDemoByGender?filters=daydate lt 2012-01-30 00:00:00,daydate gt 2012-01-01 00:00:00";

				dataset = new recline.Model.Dataset({
				  //records: []
					url: url,//+"&jsonpcallback=jsonpcallback",
				 	backend: 'jsonp'//,
					// fieldCreation: [
									// {
										// id: "realDate", 
										// formula: function(currRecord) {return currRecord.daydate + currRecord.dayhour*1000*60*60 },
										// type: "DATE"
									// }
									// ]
				});
				dataset.fetch();
				afterLoading()
				
				function afterLoading()
				{
					virtualdatasetAge= new recline.Model.VirtualDataset({
							dataset: dataset,
							aggregation: {
								dimensions: ["age"],
								aggregatedFields: ["totalviewed", "price_sum"],
								partitions: ["gender"]
							}
						});
					 
					 virtualdatasetWeekday= new recline.Model.VirtualDataset({
							dataset: dataset,
							aggregation: {
								dimensions: ["dayofweek"],
								aggregatedFields: ["totalviewed"],
								partitions: ["gender"]
							}
						});
					virtualdatasetHour= new recline.Model.VirtualDataset({
							dataset: dataset,
							aggregation: {
								dimensions: ["dayhour"],
								aggregatedFields: ["totalviewed"],
								partitions: ["gender"]
							}
						});
				
					virtualdatasetTotal= new recline.Model.VirtualDataset({
							dataset: dataset,
							aggregation: {
								dimensions: [""],
								aggregatedFields: ["totalviewed", "price_sum"]
							}
						});
					 var $el = $('#mygrid');
					 var grid = new recline.View.SlickGrid({model: virtualdatasetAge, el: $el, state: {fitColumns:true, useInnerChart:true, innerChartSerie1:'totalviewed_by_gender_Male_sum', innerChartSerie2:'totalviewed_by_gender_Female_sum', innerChartHeader:'Views by gender'}});
					 grid.visible = true;
					 grid.render();

					 // var $el = $('#mygrid_week');
					 // var grid1 = new recline.View.SlickGrid({model: virtualdatasetWeekday, el: $el, state: {fitColumns:true}});
					 // grid1.visible = true;
					 // grid1.render();

					 // var $el = $('#mygrid_hour');
					 // var grid2 = new recline.View.SlickGrid({model: virtualdatasetHour, el: $el, state: {fitColumns:true}});
					 // grid2.visible = true;
					 // grid2.render();

					 
					 virtualdatasetDay= new recline.Model.VirtualDataset({
							dataset: dataset,
							aggregation: {
								dimensions: ["daydate"],
								aggregatedFields: ["totalviewed", "price_sum"],
								partitions: ["gender"]
							}
						});
						
					var graph2 = new recline.View.NVD3Graph({
						model: virtualdatasetDay,
						state: {
							group: "daydate",
							seriesValues: ["totalviewed_by_gender_Male_sum", "totalviewed_by_gender_Female_sum"],
							colors: ["DarkTurquoise", "DodgerBlue", "LightBlue"],
							graphType: "lineChart",
							id: "2"
						}
					});
					$('#mygraph2').append(graph2.el);
					graph2.render();
					graph2.redraw();


					var graph3 = new recline.View.NVD3Graph({
						model: virtualdatasetWeekday,
						state: {
							group: "dayofweek",
							//seriesNameField: ["gender"],
							seriesValues: ["totalviewed_by_gender_Male_sum", "totalviewed_by_gender_Female_sum"],
							colors: ["DarkTurquoise", "DodgerBlue", "LightBlue"],
							graphType: "multiBarChart",
							id: "3"
						}
					});
					$('#mygraph3').append(graph3.el);
					graph3.render();
					graph3.redraw();


					var graph4 = new recline.View.NVD3Graph({
						model: virtualdatasetHour,
						state: {
							group: "dayhour",
							//seriesNameField: ["gender"],
							seriesValues: ["totalviewed_by_gender_Male_sum", "totalviewed_by_gender_Female_sum"],
							colors: ["DarkTurquoise", "DodgerBlue", "LightBlue"],
							graphType: "multiBarChart",
							id: "4"
						}
					})
					$('#mygraph4').append(graph4.el);
					graph4.render();
					graph4.redraw();
					
					
					var indicator1 = new recline.View.Indicator({
						model: virtualdatasetTotal,
						state: {
							series: ["totalviewed_sum"],
							format: ',d',
							id: "6"
						}
					});
					$('#indicator1').append(indicator1.el);
					indicator1.render();

					 var indicator2 = new recline.View.Indicator({
						model: virtualdatasetTotal,
						state: {
							series: ["price_sum_sum"],
							format: ',.02f',
							id: "7"
						}
					});
					$('#indicator2').append(indicator2.el);
					indicator2.render();
					
					var filter = new recline.View.GenericFilter({
						model: dataset,
						id: 'filterEditor',
						label: 'Filters'
					});
					$('#search_container').append(filter.el);				
				}
			});
		</script>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span2 lightgreyborder"> 
					<div class="row-fluid">
						<div id="search_container"></div>
					</div>
					<div class="row-fluid">
						<div id="facet_container"></div>
					</div>
				</div>
				<div class="span10"> 
					<div class="row-fluid" >
						<div class="span6">
							<div class="row-fluid"><h3 class="centered">Views</h3><h1 class="orange centered"><div id="indicator1"></div></h1></div>
						</div>
						<div class="span6">
							<div class="row-fluid"><h3 class="centered">Revenues</h3><h1 class="orange centered"><div id="indicator2"></div></h1></div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span12" >
							<div id="mygrid" style="overflow:auto"></div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span12"  ><div id="mygraph2"></div></div>
					</div>
					<div class="row-fluid">
						<div class="span6" ><div id="mygraph3"></div></div>
						<div class="span6" ><div id="mygraph4"></div></div>
					</div>
					<div class="row-fluid">
						<div class="span6" >
							<div id="mygrid_week" style="overflow:auto"></div>
						</div>
						<div class="span6" >
							<div id="mygrid_hour" style="overflow:auto"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>