---
layout: moviri
title: Demos - NVD3 Integration
recline-deps: true
root: ../../
---


<body xmlns="http://www.w3.org/1999/html">

<div class="container-fluid">


    <div class="row-fluid">
        <div class="span4"></div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <div id="grid1"></div>
        </div>
        <div class="span6">
            <div id="facet1"></div>
        </div>

        <table>
            <tr>
                <td>State</td>
                <td><a id="link" href="#">link</a></td>
            </tr>
            <tr>
                <td>Background</td>
                <td><select id="s1" onChange="redrawBackground();">
                    <option value="select">Select</option>
                    <option value="nobackground">No Background</option>
                    <option value="default">Default</option>
                    <option value="red">Red</option>

                </select></td>
            </tr>
        </table>


    </div>

    <div class="row-fluid">
        <div class="span9">
            <div id="visuals1"></div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span9">
            <div id="horizontal"></div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span2">
            <table class="table">
                <tr>
                    <td>range_calendar</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter1"></div>
                    </td>
                </tr>
                <tr>
                    <td>list</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter3"></div>
                    </td>
                </tr>

            </table>

        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>month_week_calendar</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter2"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>legend</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter4"></div>
                    </td>
                </tr>
                <tr>
                    <td>dropdown</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter5"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>listbox</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter6"></div>
                    </td>
                </tr>
                <tr>
                    <td>term</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter7"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>range</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter8"></div>
                    </td>
                </tr>
                <tr>
                    <td>slider</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter9"></div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="span2">
            <table class="table">
                <tr>
                    <td>range_slider</td>
                </tr>
                <tr>
                    <td>
                        <div id="filter10"></div>
                    </td>
                </tr>
                <tr>
                    <td>legend_color</td>
                </tr>

                <tr>
                    <td>
                        <div id="filter11"></div>
                    </td>
                </tr>
            </table>
        </div>
    </div>


</div>

<script>

var initialState = new recline.Data.StateManagement.State({fromQueryString:true});

var colorSchemaDate = new recline.Data.ColorSchema({
    type:"scaleWithDistinctData",
    colors:['#F7E1C5', '#6A000B']
});

var colorSchemaAge = new recline.Data.ColorSchema({
    type:"scaleWithDistinctData",
    colors:['#F7E1C5', '#6A000B']
});

var dataset = new recline.Model.Dataset({
    records:[
        {id:1, gender:"F", age:10, x:20, y:200, date:new Date(2012, 9, 1, 9, 0, 0, 0)},
        {id:2, gender:"F", age:10, x:25, y:300, date:new Date(2012, 9, 2, 10, 0, 0, 0)},
        {id:3, gender:"M", age:15, x:30, y:400, date:new Date(2012, 9, 3, 11, 0, 0, 0)},
        {id:4, gender:"F", age:15, x:40, y:450, date:new Date(2012, 9, 4, 12, 0, 0, 0)}
    ],
    fields:[
        {id:'x', type:"integer"},
        {id:'y', type:"integer"},
        {id:'age', type:"integer"} ,
        {id:'date', type:"date"},
        {id:'gender', type:"string"}
    ],
    initialState:initialState
});
colorSchemaDate.setDataset(dataset, "date");
colorSchemaAge.setDataset(dataset, "age");

dataset.queryState.addFacetNoEvent("age", true);


dataset.queryState.bind('change', function () {

    $("#link").attr("href", window.location.origin + window.location.pathname + "?" + recline.Data.StateManagement.getQueryString([dataset]));
});
dataset.queryState.bind('selection:change', function () {

    $("#link").attr("href", window.location.origin + window.location.pathname + "?" + recline.Data.StateManagement.getQueryString([dataset]));
});

//dataset.queryState.bind('change',                  function() { alert("a"); });
//dataset.queryState.bind('selection:change',        function() { alert("a"); });


var action1 = new recline.Action({
    filters:{
        filter_date_range:{type:"range", field:"date", fieldType:"date"},
        filter_date_term:{type:"term", field:"date", fieldType:"date"},
        filter_date_list:{type:"list", field:"date", fieldType:"date"},
        filter_age_list:{type:"list", field:"age", fieldType:"integer"},
        filter_age_range:{type:"range", field:"age", fieldType:"integer"},
        filter_age_term:{type:"term", field:"age", fieldType:"integer"}
    },
    models:[
        {model:dataset, filters:["filter_date_term", "filter_date_list", "filter_date_range", "filter_age_list", "filter_age_range", "filter_age_term"]}
    ],
    type:["selection"]
});


var $el = $('#grid1');
var grid1 = new recline.View.SlickGrid({
    model:dataset,
    el:$el,
    state:{  fitColumns:true,
        useHoverStyle:true,
        useStripedStyle:true,
        useCondensedStyle:true
    }
});
grid1.visible = true;
grid1.render();

/*
 var $el = $('#facet1');
 var facet = new recline.View.FacetViewer({
 model: dataset
 });
 facet.render();
 $el.append(facet.el);
 */

var filterhorizontal;

drawGraph();


dataset.fetch();


function drawGraph() {

    var filter1 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'range_calendar', type:"range", fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter1').append(filter1.el);

    var filter2 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'month_week_calendar', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter2').append(filter2.el);

    var filter3 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'list', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter3').append(filter3.el);

    var filter4 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'legend', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter4').append(filter4.el);

    var filter5 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'dropdown', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_term"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter5').append(filter5.el);

    var filter6 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'listbox', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter6').append(filter6.el);

    var filter7 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'term', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_term"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter7').append(filter7.el);

    var filter8 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"date", controlType:'range', fieldType:"date" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"date", filter:"filter_date_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter8').append(filter8.el);

    var filter9 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'slider', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_term"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter9').append(filter9.el);


    var filter10 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'range_slider', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_range"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter10').append(filter10.el);


    var filter11 = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'color_legend', fieldType:"integer" }
        ],
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#filter11').append(filter11.el);


    filterhorizontal = new recline.View.GenericFilter({
        sourceDataset:dataset,
        sourceFields:[
            {field:"age", controlType:'color_legend', fieldType:"integer", label: "Select age" },
            {field:"age", controlType:'dropdown', fieldType:"integer" , label: "Select age", showLabelInsideFilter: true },
            {field:"age", controlType:'listbox_styled', fieldType:"integer", label: "Select age", showLabelInsideFilter: true },
            {field:"age", controlType:'multibutton', fieldType:"integer", label: "Select age"},
            {field:"age", controlType:'radiobuttons', fieldType:"integer",  useFieldLabel:true  }

        ],
        state:{
            useHorizontalLayout:true,
            title:"Title",
            description:"Description"
        },
        actions:[
            {
                action:action1,
                mapping:[
                    {srcField:"age", filter:"filter_age_list"}
                ],
                event:["selection"]
            }
        ]
    });
    $('#horizontal').append(filterhorizontal.el);

}


function redrawBackground() {
    var type = getSelectedText("s1");
    var filter = [filterhorizontal];

    var showBackground = true;
    var backgroundColor;

    if(type == "nobackground") {
        showBackground = false;
    }else if(type =="red") {
        backgroundColor = "#FF0000"
    };


    _.each(filter, function (d) {
        d.options.state["showBackground"] = showBackground;
        if(backgroundColor)
            d.options.state["backgroundColor"] = backgroundColor;
        d.render();
    });
}


function getSelectedText(element) {
    var elt = document.getElementById(element);

    if (elt.selectedIndex == -1)
        return null;

    return elt.options[elt.selectedIndex].value;
}

</script>

</body>

