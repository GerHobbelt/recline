<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard - Recline Data Explorer and Library</title>

    <script type="text/javascript" src="../../vendor/jquery/1.7.1/jquery.js"></script>
    <script type="text/javascript" src="../../vendor/bootstrap/2.1.1/js/bootstrap.js"></script>

    <link rel="stylesheet" href="../../css/default.css" />
    <link rel="stylesheet" href="../../vendor/bootstrap/2.1.1/css/bootstrap.css" />



    <link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet/0.4.4/leaflet.ie.css" />
<![endif]-->
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.css">
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.css">
<!--[if lte IE 8]>
<link rel="stylesheet" href="../../vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
<![endif]-->
<link type="text/css" href="../../css/jquery-ui-1.8.18.custom.css" rel="stylesheet" />
<link rel="stylesheet" href="../../vendor/slickgrid/2.0.1/slick.grid.css">


  <!-- 3rd party JS libraries -->

  <script type="text/javascript" src="../../vendor/underscore/1.3.3/underscore.js"></script>
  <script type="text/javascript" src="../../vendor/backbone/0.9.2/backbone.js"></script>
  <script type="text/javascript" src="../../vendor/mustache/0.5.0-dev/mustache.js"></script>
  <script type="text/javascript" src="../../vendor/flotr2/flotr2.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.1/jquery-ui-1.8.16.custom.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.1/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.1/slick.core.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.1/slick.editors.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.1/slick.formatters.js"></script>
  <script type="text/javascript" src="../../vendor/slickgrid/2.0.1/slick.grid.js"></script>
  <script type="text/javascript" src="../../vendor/moment/1.6.2/moment.js"></script>
  <script type="text/javascript" src="../../vendor/crossfilter/1.1.0/crossfilter.min.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="../../vendor/leaflet.markercluster/leaflet.markercluster.js"></script>


<!-- NVD3 & D3 libraries -->
  <link rel="stylesheet" href="../../vendor/nvd3/0.0.1/nv.d3.css">

  <script type="text/javascript" src="../../vendor/d3/v2/d3.v2.min.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/nv.d3.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/tooltip.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/utils.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/legend.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/axis.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/scatter.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/line.js"></script>
  <script type="text/javascript" src="../../vendor/nvd3/0.0.1/models/lineChart.js"></script>


  <!--
    ## Just use the all in one library version rather than individual files

  <script type="text/javascript" src="../../dist/recline.js"></script>

  -->

  <!-- model and backends -->
  <script type="text/javascript" src="../../src/model.js"></script>
  <script type="text/javascript" src="../../src/backend.memory.js"></script>
  <script type="text/javascript" src="../../src/backend.dataproxy.js"></script>
  <script type="text/javascript" src="../../src/backend.gdocs.js"></script>
  <script type="text/javascript" src="../../src/backend.elasticsearch.js"></script>
  <script type="text/javascript" src="../../src/backend.csv.js"></script>
  <script type="text/javascript" src="../../src/backend.jsonp.js"></script>

  <!-- views -->
  <script type="text/javascript" src="../../src/view.grid.js"></script>
  <script type="text/javascript" src="../../src/view.slickgrid.js"></script>
  <script type="text/javascript" src="../../src/view.transform.js"></script>
  <script type="text/javascript" src="../../src/data.transform.js"></script>
  <script type="text/javascript" src="../../src/view.graph.js"></script>
  <script type="text/javascript" src="../../src/view.map.js"></script>
  <script type="text/javascript" src="../../src/view.timeline.js"></script>
  <script type="text/javascript" src="../../src/widget.pager.js"></script>
  <script type="text/javascript" src="../../src/widget.queryeditor.js"></script>
  <script type="text/javascript" src="../../src/widget.filtereditor.js"></script>
  <script type="text/javascript" src="../../src/widget.fields.js"></script>
  <script type="text/javascript" src="../../src/view.multiview.js"></script>
  <script type="text/javascript" src="../../src/view.nvd3.graph.js"></script>
  <script type="text/javascript" src="../../src/view.indicator.js"></script>
  <script type="text/javascript" src="../../src/virtualmodel.js"></script>
  <script type="text/javascript" src="../../src/widget.genericfilter.js"></script>







</head>
<body>


<div class="container-fluid">
    <div class="row-fluid">
        <div class="span2 lightgreyborder">
            <div class="row-fluid">
                <div id="search_container"></div>
            </div>
            <div class="row-fluid">
                <div id="search_container2"></div>
            </div>
            <div class="row-fluid">
                <div id="facet_container"></div>
            </div>
        </div>
        <div class="span10">
            <div class="row-fluid" >
                <div class="span6">
                    <div class="row-fluid"><h3 class="centered">Views</h3><h1 class="orange centered"><div id="indicator1"></div></h1></div>
                </div>
                <div class="span6">
                    <div class="row-fluid"><h3 class="centered">Revenues</h3><h1 class="orange centered"><div id="indicator2"></div></h1></div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12" >
                    <div id="mygrid" style="overflow:auto"></div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12"  ><div id="mygraph2"></div></div>
            </div>
            <div class="row-fluid">
                <div class="span6" ><div id="mygraph3"></div></div>
                <div class="span6" ><div id="mygraph4"></div></div>
            </div>
            <div class="row-fluid">
                <div class="span6" >
                    <div id="mygrid_week" style="overflow:auto"></div>
                </div>
                <div class="span6" >
                    <div id="mygrid_hour" style="overflow:auto"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function() {
        var url = "http://192.168.100.133:8380/cwwh-iwal-war/cw/wh/ds/AudDemoByGender"; //?filters=daydate lt 2012-01-30 00:00:00,daydate gt 2012-01-01 00:00:00";

        dataset = new recline.Model.Dataset({
            url: url,
            backend: 'jsonp',
            id: "AudDemoByGender"

        });

		//dataset.fetch();

        filter = [ {field: "daydate", type: "range", start:"2012-01-01 00:00:00", stop: "2012-03-30 00:00:00", fieldType: "date", controlType:"range_calendar"}];

        dataset.queryState.setFilter(filter);
		
			virtualdataset = new recline.Model.VirtualDataset({
                dataset: dataset,
                aggregation: {
                    dimensions: null,
                    aggregatedFields: []
                }			
			});

            virtualdatasetAge = new recline.Model.VirtualDataset({
                dataset: virtualdataset,
                aggregation: {
                    dimensions: ["age"],
                    aggregatedFields: ["totalviewed", "price_sum"],
                    partitions: ["gender"]
                }
            });

            virtualdatasetWeekday= new recline.Model.VirtualDataset({
                dataset: virtualdataset,
                aggregation: {
                    dimensions: ["dayofweek"],
                    aggregatedFields: ["totalviewed"],
                    partitions: ["gender"]
                }
            });
            virtualdatasetHour= new recline.Model.VirtualDataset({
                dataset: virtualdataset,
                aggregation: {
                    dimensions: ["dayhour"],
                    aggregatedFields: ["totalviewed"],
                    partitions: ["gender"]
                }
            });

            virtualdatasetTotal= new recline.Model.VirtualDataset({
                dataset: virtualdataset,
                aggregation: {
                    dimensions: [""],
                    aggregatedFields: ["totalviewed", "price_sum"]
                }
            });
            var $el = $('#mygrid');
            var grid = new recline.View.SlickGrid({model: virtualdatasetAge, el: $el, state: {fitColumns:true, useInnerChart:true, innerChartSerie1:'totalviewed_by_gender_Male_sum', innerChartSerie2:'totalviewed_by_gender_Female_sum', innerChartHeader:'Views by Gender'}});
            grid.visible = true;
            grid.render();

            // var $el = $('#mygrid_week');
            // var grid1 = new recline.View.SlickGrid({model: virtualdatasetWeekday, el: $el, state: {fitColumns:true}});
            // grid1.visible = true;
            // grid1.render();

            // var $el = $('#mygrid_hour');
            // var grid2 = new recline.View.SlickGrid({model: virtualdatasetHour, el: $el, state: {fitColumns:true}});
            // grid2.visible = true;
            // grid2.render();


            virtualdatasetDay= new recline.Model.VirtualDataset({
                dataset: virtualdataset,
                aggregation: {
                    dimensions: ["daydate"],
                    aggregatedFields: ["totalviewed", "price_sum"],
                    partitions: ["gender"]
                }
            });

            var graph2 = new recline.View.NVD3Graph({
                model: virtualdatasetDay,
                state: {
                    group: "daydate",
                    seriesValues: ["totalviewed_by_gender_Male_sum", "totalviewed_by_gender_Female_sum"],
                    colors: ["DarkTurquoise", "DodgerBlue", "LightBlue"],
                    graphType: "lineChart",
                    id: "2"
                }
            });
            $('#mygraph2').append(graph2.el);
            graph2.render();
            graph2.redraw();


            var graph3 = new recline.View.NVD3Graph({
                model: virtualdatasetWeekday,
                state: {
                    group: "dayofweek",
                    //seriesNameField: ["gender"],
                    seriesValues: ["totalviewed_by_gender_Male_avg", "totalviewed_by_gender_Female_avg"],
                    colors: ["DarkTurquoise", "DodgerBlue", "LightBlue"],
                    graphType: "multiBarChart",
                    id: "3"
                }
            });
            $('#mygraph3').append(graph3.el);
            graph3.render();
            graph3.redraw();


            var graph4 = new recline.View.NVD3Graph({
                model: virtualdatasetHour,
                state: {
                    group: "dayhour",
                    //seriesNameField: ["gender"],
                    seriesValues: ["totalviewed_by_gender_Male_avg", "totalviewed_by_gender_Female_avg"],
                    colors: ["DarkTurquoise", "DodgerBlue", "LightBlue"],
                    graphType: "multiBarChart",
                    id: "4"
                }
            })
            $('#mygraph4').append(graph4.el);
            graph4.render();
            graph4.redraw();


            var indicator1 = new recline.View.Indicator({
                model: virtualdatasetTotal,
                state: {
                    series: ["totalviewed_sum"],
                    format: ',d',
                    id: "6"
                }
            });
            $('#indicator1').append(indicator1.el);
            indicator1.render();

            var indicator2 = new recline.View.Indicator({
                model: virtualdatasetTotal,
                state: {
                    series: ["price_sum_sum"],
                    format: ',.02f',
                    id: "7"
                }
            });
            $('#indicator2').append(indicator2.el);
            indicator2.render();

            var filter = new recline.View.GenericFilter({
                sourceDataset: dataset,
				targetDatasets: [dataset],
                id: 'filterEditorDB',
                label: 'DB Filters',
            });
            $('#search_container').append(filter.el);

            var filter2 = new recline.View.GenericFilter({
                sourceDataset: virtualdataset,
				targetDatasets: [virtualdatasetAge, virtualdatasetWeekday, virtualdatasetHour, virtualdatasetTotal],
                id: 'filterEditor',
                label: 'Memory Filters',
				userFilters: [{field: 'age', type:'list', controlType: 'list', fieldType: 'string'}]
            });
            $('#search_container2').append(filter2.el);
    });
</script>


</body>
</html>
